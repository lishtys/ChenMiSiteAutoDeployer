---
title: Resources Mapping In Unity
tags:
  - Unity
  - AssetsBundle
  - Addressable
categories:
  - Unity
  - Assets
toc: true
abbrlink: 27064
date: 2020-05-20 15:29:00
---

# Assets Identification and Reference

## Assets & Objects

> **Asset**: files or folders in `Project Window`.
> **Object**: Inherit from `Unity.Objects`. It is a serializable data used to describe an instance of a specific resource. It can represent any type supported by Unity.

There is a 1-N relationship between Asset and Object. For example, Prefab is an Asset while it contains many Object; 
<!--more-->
## File GUIDs and Local IDs

Unity divides the serialization into two parts. The first part is called `File GUID` in '.meta' files in the project folder.

- automatically generated by Unity after first importing.
- automatically synced when moving inside Unity editor
- Only when Unity editor running, the editor can regenerate the same `File GUID` when deleting meta files. Whereas, deleting meta files causes reference missing.

`Local ID` is used as a unique identifier for Object in Asset. Besides, Unity internally maintains a mapping table of assets GUID.  Changing new assets also updates the mapping table automatically. So that missing a meta file or changes its GUID accidentally causes showing "Missing Scripts" in the editor.

## Library

To avoid re-processing assets during launching editor, whose converting operation costs lots of time, all the converting results are saved in `Library/metadata/`. Use the first two characters in the File GUID name folder.

## Instance ID

Unity uses another cache system called `PersistentManager` to maintain references and dependencies between objects and assets.

`PersistentManager` converts Files GUID and Local ID to an Integer that unique in a session. These integers are called `Instance ID`. It is auto-incrementing. Whenever a new object needs to be registered in the cache, it simply increments. 

To put it simply: `PersistentManager` maintains the mapping relationship between Instance ID, File GUID, and Local ID. Therefore It can locate Object data and maintain Object instance in memory quickly.

As long as the system resolves to an Instance ID, it can quickly find the loaded object related to Instance ID. Even if the Object has not been loaded, using File GUID and Local Id can quickly get the Assets and load in time.



# Resources Lyfe Cycle

## Object Loading

1. When Unity application launch, **Persistent Manager** would initialize all the data used next (ex: assets in the launch scene and its dependency), and the Objects in `Resources`. 
2. In the following cases, Objects will be retained but not loaded and display "(Missing)" in the editor including a null pointer, pink color due to missing materials and resources. 
3. 



## Object Unloading

1. `Resources.UnloadUnusedAssets`: unload Objects with no reference.
2. `Resources.UnloadAsset`: unload Object from Resources folder. Objects' Instance ID keep effective and includes File GUID and Local ID. These objects would be loaded immediately after any Mono Variable or Object accessing.
3. `AssetBundle.Unload(true) `: Immediately unload Objects in AssetsBundle,  deactivate their File GUID, Local ID, and Instance ID. Return NullReferenceException when any object access after unloading.
4. `AssetBundle.Unload(false) `: The Objects won't be destroyed with AssetBundle within the life cycle. However, Unity stops the mapping between File GUID„ÄÅLocal ID with Instance ID. In another word, these objects cannot be loaded after being destroyed sometime in the future. Besides, after an object loses connection with its AssetsBundle, Unity creates a new Instance ID  when the same Asset is loaded, which causes multiple copies of redundant resources.


